Kubernetes(K8s) 기초: 컨테이너 오케스트레이션 완전 가이드
================================================================

1. Kubernetes란?
----------------

Kubernetes(흔히 K8s라고 불림)는 컨테이너화된 애플리케이션의 배포, 확장 및 관리를
자동화하는 오픈소스 플랫폼입니다. Docker가 앱을 컨테이너로 패키징하는 것을 돕는다면,
Kubernetes는 여러 머신에서 이를 실행하고 확장하는 것을 돕습니다.

Kubernetes는 현대 소프트웨어 개발에 필수적인 도구로, 컨테이너 오케스트레이션의
산업 표준으로 자리 잡았습니다. 이를 통해 개발자는 복잡한 인프라 관리 대신
애플리케이션 개발에 집중할 수 있습니다.

2. Docker vs Kubernetes
-----------------------

Docker와 Kubernetes는 경쟁 관계가 아닌 상호 보완적인 도구입니다:

Docker의 역할:
- 개별 컨테이너 생성 및 관리
- 애플리케이션을 컨테이너 이미지로 패키징
- 단일 호스트에서 컨테이너 실행

Kubernetes의 역할:
- 여러 컨테이너의 오케스트레이션
- 여러 머신에 걸친 클러스터 관리
- 자동 확장, 로드 밸런싱, 셀프 힐링

Docker만 사용할 때의 한계:
- 수동 스케일링
- 수동 로드 밸런싱
- 장애 시 수동 복구 필요
- 여러 호스트 관리 복잡

Kubernetes가 제공하는 이점:
- 스케일링: Docker는 여러 컨테이너를 실행할 수 있지만, Kubernetes는 여러 머신에
  걸쳐 컨테이너 클러스터를 관리하며 수요에 따라 자동으로 확장/축소합니다.
- 로드 밸런싱: Kubernetes는 컨테이너 간에 트래픽을 분산하여 단일 컨테이너가
  과부하되지 않도록 합니다.
- 셀프 힐링: Kubernetes는 실패한 컨테이너를 재시작하고 필요시 다른 노드로 이동시킵니다.

3. 핵심 컴포넌트
----------------

3.1 Pod (파드)
Pod는 Kubernetes에서 가장 작은 배포 단위입니다. Pod는 애플리케이션의 단일 격리된
인스턴스와 이를 실행하는 데 필요한 리소스를 나타내며, 각각 고유한 IP 주소를 가집니다.
Pod는 같은 노드에서 함께 작동하고 생명주기를 공유하는 하나 이상의 컨테이너로 구성됩니다.

특징:
- 가장 작은 배포 단위
- 하나 이상의 컨테이너 포함
- 공유 스토리지/네트워크
- 고유 IP 주소

예시 Pod 정의:
```yaml
apiVersion: v1
kind: Pod
metadata:
  name: my-pod
spec:
  containers:
  - name: my-container
    image: nginx:latest
    ports:
    - containerPort: 80
```

3.2 Service (서비스)
Service는 Pod 집합을 네트워크를 통해 노출하는 추상화입니다. 애플리케이션은 종종
로드 밸런싱과 수평 스케일링을 위해 여러 복제본으로 배포됩니다.

Service 유형:
- ClusterIP: 클러스터 내부에서만 접근 가능 (기본값)
- NodePort: 노드의 특정 포트로 외부 접근 가능
- LoadBalancer: 외부 로드 밸런서 사용
- ExternalName: 외부 서비스를 DNS로 매핑

3.3 Deployment (디플로이먼트)
Deployment는 Pod의 선언적 업데이트를 제공합니다. 원하는 상태를 정의하면
Kubernetes가 현재 상태를 원하는 상태로 변경합니다.

예시 Deployment:
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-deployment
spec:
  replicas: 3
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx:1.14.2
        ports:
        - containerPort: 80
```

3.4 Control Plane (컨트롤 플레인)
컨트롤 플레인(마스터 노드)은 클러스터를 조정합니다.

주요 컴포넌트:
- API Server: 클러스터의 프론트엔드
- etcd: 클러스터 데이터를 저장하는 키-값 저장소
- Scheduler: 새 Pod를 노드에 할당
- Controller Manager: 컨트롤러 프로세스 실행

3.5 Node (노드)
노드는 애플리케이션을 실행하는 워커입니다. Pod를 포함하는 컨테이너의 호스트 역할을 합니다.

노드 컴포넌트:
- kubelet: Pod가 실행 중인지 확인
- kube-proxy: 네트워크 규칙 관리
- Container Runtime: 컨테이너 실행 (Docker, containerd 등)

4. 시작하기
-----------

4.1 Minikube
Minikube는 그룹의 컴퓨터처럼 동작하는 단일 머신의 간단한 싱글 노드 클러스터입니다.
이 단순화된 클러스터 형태와 시뮬레이션된 동작은 Minikube를 완벽한 개발 및 테스트 환경으로
만듭니다. 몇 분 안에 로컬에서 Kubernetes를 실행할 수 있습니다.

설치 및 시작:
```bash
# Minikube 설치 (macOS)
brew install minikube

# 클러스터 시작
minikube start

# 상태 확인
minikube status
```

4.2 Docker Desktop
Docker Desktop에서 Kubernetes를 활성화할 수도 있습니다.

Docker Dashboard에서 Settings > Kubernetes 탭으로 이동하여 "Enable Kubernetes"
체크박스를 선택하고 Apply를 클릭합니다.

5. 기본 kubectl 명령어
----------------------

kubectl은 Kubernetes 클러스터와 상호작용하는 CLI 도구입니다.

```bash
# 클러스터 정보 확인
kubectl cluster-info

# 노드 목록
kubectl get nodes

# Pod 목록
kubectl get pods

# 모든 리소스 확인
kubectl get all

# Deployment 생성
kubectl apply -f deployment.yaml

# Pod 상세 정보
kubectl describe pod <pod-name>

# Pod 로그 확인
kubectl logs <pod-name>

# Pod 내부 접속
kubectl exec -it <pod-name> -- /bin/bash

# 리소스 삭제
kubectl delete -f deployment.yaml
```

6. 주요 개념
------------

6.1 Namespace (네임스페이스)
클러스터 내에서 리소스를 논리적으로 분리하는 방법입니다.

```bash
# 네임스페이스 생성
kubectl create namespace dev

# 특정 네임스페이스의 리소스 조회
kubectl get pods -n dev
```

6.2 ConfigMap과 Secret
애플리케이션 설정과 민감한 데이터를 관리합니다.

6.3 Persistent Volume (PV)와 Persistent Volume Claim (PVC)
Pod가 재시작되어도 데이터를 유지하기 위한 스토리지 관리입니다.

6.4 Ingress
클러스터 외부에서 서비스로의 HTTP/HTTPS 라우팅을 관리합니다.

7. 모범 사례
------------

7.1 리소스 관리
- 리소스 요청과 제한 설정
- Horizontal Pod Autoscaler 사용
- Pod 분산 규칙 설정

7.2 보안
- RBAC(Role-Based Access Control) 사용
- Secret으로 민감한 정보 관리
- Network Policy로 트래픽 제어
- 이미지 취약점 스캔

7.3 모니터링
- Prometheus와 Grafana 사용
- 로그 수집 (ELK 스택, Loki 등)
- 알림 설정

8. 결론
-------

Kubernetes는 컨테이너화된 애플리케이션을 대규모로 운영하는 데 필수적인 도구입니다.
처음에는 복잡해 보일 수 있지만, 기본 개념을 이해하면 강력한 기능을 활용할 수 있습니다.

Minikube나 Docker Desktop으로 시작하여 점진적으로 학습하는 것을 권장합니다.

참고 자료:
- Kubernetes 공식 문서: https://kubernetes.io/docs/
- Minikube 공식 문서: https://minikube.sigs.k8s.io/docs/
- Docker 공식 문서: https://docs.docker.com/
